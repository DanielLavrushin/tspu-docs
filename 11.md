# 11. Фильтр: аппаратная платформа

[← Оглавление](README.md) · [← Раздел 10: Сегмент управления ТСПУ](10.md)

---

## 11.1. Младшая линейка: EcoFilter 2020/2040

Фильтры выпускаются в двух линейках. **Младшая линейка** включает модели:

| Модель           | Количество 10G-интерфейсов для трафика |
| ---------------- | -------------------------------------- |
| **EcoFilter 20** | 2 × 10 Гбит/с                         |
| **EcoFilter 40** | 4 × 10 Гбит/с                         |

Модели младшей линейки отличаются от старшей только количеством десятигигабитных интерфейсов для обработки трафика. Внутренняя архитектура, программное обеспечение и принципы работы — одинаковы.

## 11.2. Старшая линейка: EcoFilter 4080/4120/4160

**Старшая линейка** включает модели с большим количеством интерфейсов:

| Модель               | Количество 10G-интерфейсов для трафика |
| -------------------- | -------------------------------------- |
| **EcoFilter 4080**   | 8 × 10 Гбит/с                         |
| **EcoFilter 4120**   | 12 × 10 Гбит/с                        |
| **EcoFilter 4160**   | 16 × 10 Гбит/с                        |

Как видно из названий, номер модели напрямую связан с количеством интерфейсов: **40**80 → **8**×10G, **41**20 → **12**×10G, **41**60 → **16**×10G.

Все модели обеих линеек:

- монтируются в 19-дюймовую стойку, форм-фактор **1U**;
- оснащены **двумя блоками питания** (постоянного или переменного тока), заменяемыми на горячую;
- имеют **вентиляторы**, заменяемые на горячую;
- имеют порты **Console**, **Management** и **лог-интерфейсы** на передней панели.

> **Примечание о производительности.** Маркетинговые материалы указывают производительность до 160 Гбит/с, однако эта цифра относится к функционалу NAT-трансляции, который в проекте ТСПУ не используется. Реальная производительность в режиме DPI-фильтрации существенно ниже и зависит от профиля трафика.

## 11.3. Модели 2019 года (пилотный проект, Урал)

Модели 2019 года установлены на **пилотном проекте** (Уральский регион) и продолжают там работать.

### 11.3.1. Процессоры Intel Xeon 2695/2699, 18/22 ядра, 128/256 ГБ RAM

| Параметр                | EcoFilter 4080              | EcoFilter 4120 / 4160       |
| ----------------------- | --------------------------- | --------------------------- |
| **Процессор**           | Intel Xeon 2695             | Intel Xeon 2699             |
| **Количество ядер**     | 18                          | 22                          |
| **Оперативная память**  | 128 ГБ                      | 256 ГБ                      |
| **Накопитель**          | SSD 32 ГБ                   | SSD 32 ГБ                   |
| **Блоки питания**       | 2 (AC или DC), hot-swap     | 2 (AC или DC), hot-swap     |

На передней панели расположены разъёмы Console, Management и лог-интерфейс. На задней панели — два медных логирующих порта и от 8 до 16 десятигигабитных интерфейсов для обработки трафика.

### 11.3.2. Фиксированные сетевые интерфейсы

В моделях 2019 года сетевые интерфейсы для обработки трафика **встроены** в платформу — заменить или поменять интерфейсные платы невозможно. Количество и тип портов определяются моделью на этапе производства.

## 11.4. Модели 2020 года (федеральный проект)

Модели 2020 года поставляются в рамках **федерального проекта** и имеют ряд улучшений по сравнению с моделями 2019 года.

### 11.4.1. Процессор Intel Xeon Gold 6212, 24 ядра, 192/384 ГБ RAM

| Параметр                | EcoFilter 4080              | EcoFilter 4120 / 4160       |
| ----------------------- | --------------------------- | --------------------------- |
| **Процессор**           | Intel Xeon Gold 6212        | Intel Xeon Gold 6212        |
| **Количество ядер**     | 24                          | 24                          |
| **Оперативная память**  | 192 ГБ                      | 384 ГБ                      |
| **Накопитель**          | SSD 32 ГБ                   | SSD 32 ГБ                   |
| **Блоки питания**       | 2 (AC или DC), hot-swap     | 2 (AC или DC), hot-swap     |

Процессор нового поколения (**Gold 6212** вместо серии 2695/2699) обеспечивает большее количество ядер (24 против 18/22) и поддержку большего объёма оперативной памяти.

### 11.4.2. Сменные сетевые интерфейсы, 4× SFP+ лог-порта

Ключевые отличия от моделей 2019 года:

- **Сменные сетевые интерфейсы** — интерфейсные платы для обработки трафика можно вытаскивать и заменять, что упрощает обслуживание и позволяет адаптировать конфигурацию под конкретную площадку;
- **Лог-интерфейсы** — вместо двух медных портов на задней панели теперь **4 порта SFP+ (10 Гбит/с)** для логирования.

Поставщики аппаратных платформ для федерального проекта могут быть **разными** (например, стандартная «голубая» платформа RDP.ru или чёрные платформы от вендора Lanner), поэтому внешний вид может отличаться. Однако внутренняя аппаратная начинка и принципы работы остаются одинаковыми.

## 11.5. Разделение интерфейсов: LAN (чётные) / WAN (нечётные)

Все интерфейсы фильтра, предназначенные для обработки трафика, **строго разделены** на две группы:

```text
    Передняя панель фильтра (пример EcoFilter 4160)

    ┌──────────────────────────────────────────────────┐
    │  Console  Mgmt  Log                              │
    │                                                  │
    │  Интерфейсы для трафика:                         │
    │                                                  │
    │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐ ... │
    │  │ 0  │ │ 1  │ │ 2  │ │ 3  │ │ 4  │ │ 5  │     │
    │  │LAN │ │WAN │ │LAN │ │WAN │ │LAN │ │WAN │     │
    │  └────┘ └────┘ └────┘ └────┘ └────┘ └────┘     │
    │  чёт.   нечёт.  чёт.   нечёт.  чёт.   нечёт.  │
    └──────────────────────────────────────────────────┘
```

| Тип порта | Нумерация     | Направление                       |
| --------- | ------------- | --------------------------------- |
| **LAN**   | Чётные (0, 2, 4, 6...) | В сторону абонентов (от балансировщика) |
| **WAN**   | Нечётные (1, 3, 5, 7...) | В сторону интернета (к балансировщику) |

Этот принцип чётных/нечётных портов **един** для всех моделей и поколений фильтров. Он же используется на балансировщиках EcoFilter Balancer (но **не соблюдается** на Eco Highway — подробнее в [разделе 7.4.1](07.md)).

Разделение LAN/WAN прослеживается через всё оборудование ТСПУ — от байпасов через балансировщики до фильтров. Это фундаментальный принцип архитектуры: трафик от абонентов всегда приходит со стороны LAN, трафик из интернета — со стороны WAN.

## 11.6. История платформы: от CGNAT (2013) к DPI-фильтру

Платформа фильтра имеет длительную историю развития, начавшуюся **в 2013 году** с устройства **CGNAT** (Carrier-Grade NAT), предназначенного для трансляции адресов у операторов связи. Поскольку платформа изначально создавалась для операторского применения, часть внутренней архитектуры (сессии, трансляции, понятия LAN/WAN) заточена под этот сценарий — что объясняет некоторые особенности, с которыми приходится сталкиваться при эксплуатации в режиме DPI-фильтра.

```text
    2013    CGNAT (трансляция адресов)
      │
      ├──── URL-фильтрация
      │
      ├──── PPPoE BRAS (не используется в проекте ТСПУ)
      │
      ├──── Router (параллельная ветка, не используется)
      │
      └──── DPI (распознавание протоколов) ◄── используется в проекте ТСПУ
```

Из всего доступного функционала платформы в проекте ТСПУ используются только **два модуля**:

| Модуль         | Назначение                                                    |
| -------------- | ------------------------------------------------------------- |
| **EcoFilter**  | Фильтрация трафика по спискам (реестр РКН, DPI-листы)        |
| **EcoDPI**     | Распознавание трафика приложений вплоть до 7-го уровня модели OSI |

Остальной функционал (NAT, BRAS, QoS, маршрутизация) доступен в прошивке, но **не задействован** в проекте ТСПУ.

---

[← Оглавление](README.md) · [← Раздел 10: Сегмент управления ТСПУ](10.md) · [Раздел 12: Сессии и трансляции на фильтре →](12.md)
